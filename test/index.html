<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Palette Analyzer</title>
    <script src="../../build/palette-analyzer.js"></script>
    <script src="https://vega.github.io/vega/vega.js"></script>
</head>
<body>
    <div id="line-chart"></div>
    <div id="vis-tooltip"></div>
    <script>
      var palletes = [
        'viridis',
        'inferno',
        'magma',
        'plasma',
        'spectral',
        'greens',
        'blues',
        'purples',
        'reds',
        'oranges',
        'greys',
        'tableau10',
        'tableau20'
      ];

      var spec = {
        "$schema": "https://vega.github.io/schema/vega/v3.0.json",
        "width": 700,
        "height": 400,
        "padding": 5,

        "signals": [
          {
            "name": "palette", "value": palletes[0],
            "bind": {"input": "select", "options": palletes}
          },
          {
            "name": "stride", "value": 0.05,
            "bind": {"input": "range", "min": 0.01, "max": 0.2, "step": 0.01}
          }
        ],

        "data": [
          {
            "name": "perPalette",
            "values": palette_analyzer.analyze(palletes[0], 0.05)
          }
        ],

        "scales": [
          {
            "name": "x",
            "type": "point",
            "range": "width",
            "domain": {"data": "perPalette", "field": "x"}
          },
          {
            "name": "y",
            "type": "linear",
            "range": "height",
            "nice": true,
            "zero": true,
            "domain": {"data": "perPalette", "field": "y"}
          },
          {
            "name": "color",
            "type": "ordinal",
            "range": "category",
            "domain": {"data": "perPalette", "field": "space", "sort": true}
          }
        ],

        "axes": [
          {"orient": "bottom", "scale": "x", "title": "Color"},
          {"orient": "left", "scale": "y", "title": "Local Distance"}
        ],

        "marks": [
          {
            "name": "p_group",
            "type": "group",
            "from": {
              "facet": {
                "name": "faceted_table",
                "data": "perPalette",
                "groupby": ["space"]
              }
            },
            "encode": {
              "update": {
                "width": {"field": {"group": "width"}},
                "height": {"field": {"group": "height"}}
              }
            },
            "marks": [
              {
                "type": "line",
                "from": {"data": "faceted_table"},
                "encode": {
                  "enter": {
                    "x": {"scale": "x", "field": "x"},
                    "y": {"scale": "y", "field": "y"},
                    "stroke": {"scale": "color", "field": "space"},
                    "strokeWidth": {"value": 3}
                  }
                }
              },
              {
                "type": "symbol",
                "from": {"data": "faceted_table"},
                "encode": {
                  "enter": {
                    "x": {"scale": "x", "field": "x"},
                    "y": {"scale": "y", "field": "y"},
                    "fill": {"value": "#fff"},
                    "stroke": {"field": "space"},
                    "strokeWidth": {"value": 1},
                    "size": {"value": 49}
                  }
                }
              },
            ]
          }
        ],
        "legends": [
          {"stroke": "color", "title": "Color Space"}
        ]
      };

      var view = new vega.View(vega.parse(spec), {
        loader: vega.loader({baseURL: 'https://vega.github.io/vega/'}),
        logLevel: vega.Warn,
        renderer: 'canvas'
      }).initialize('#line-chart')
        .hover()
        .run()
        .addSignalListener('stride', function (name, value) {
          update(view.signal('palette'), value, view);
        })
        .addSignalListener('palette', function (name, value) {
          update(value, view.signal('stride'), view);
        });

      var update = function (palette, stride, view) {
        var data = view.data('perPalette').slice();
        view.change('perPalette', vega.changeset().remove(data).insert(palette_analyzer.analyze(palette, stride)));
      }

    </script>
</body>
</html>
